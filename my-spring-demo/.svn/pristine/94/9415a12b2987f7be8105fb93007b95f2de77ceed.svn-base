<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.isz.erp.house.mapper.HouseDevelopImgMapper">
	<!-- resultMap -->
	<resultMap id="HouseDevelopImgBaseMap" type="com.isz.erp.facade.house.entity.HouseDevelopImg">
	    <id column="house_img_id" property="house_img_id"/>
	    <result column="house_develop_id" property="house_develop_id"/>
	    <result column="img_id" property="img_id"/>
	    <result column="img_name" property="img_name"/>
	    <result column="img_type" property="img_type"/>
	    <result column="src" property="src"/>
	    <result column="deleted" property="deleted"/>
	    <result column="sort" property="sort"/>
	    <result column="create_time" property="create_time"/>
	    <result column="create_uid" property="create_uid"/>
	    <result column="create_user" property="create_user"/>
	    <result column="create_dep" property="create_dep"/>
 	</resultMap>
 	
 	<!-- 批量插入开发房源图片信息 -->
	<insert id="saveHouseDevelopImg" parameterType="java.util.List">
		INSERT INTO `house_develop_img` 
			(`house_img_id`,`house_develop_id`, `img_id`, `img_name`, `img_type`, `deleted`, `sort`, `create_time`, `create_uid`)
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	   (#{item.house_img_id},#{item.house_develop_id},#{item.img_id},#{item.img_name},#{item.img_type},
     	   #{item.deleted},#{item.sort},#{item.create_time},#{item.create_uid})  
   		</foreach>  
  	</insert>
  	<!-- 删除当前房屋下的所有图片信息 -->
  	<delete id="deleteByHouseDevelopId" parameterType="java.lang.String">
  		UPDATE `house_develop_img` SET `deleted`=1 WHERE `house_develop_id`=#{house_develop_id}
  	</delete>
  	<!-- 新增单个图片 -->
  	<insert id="insertHouseDevelopImg" parameterType="com.isz.erp.facade.house.entity.HouseDevelopImg">
  		INSERT INTO `house_develop_img` 
			(`house_img_id`,`house_develop_id`, `img_id`, `img_name`, `img_type`, `deleted`, `sort`, `create_time`, `create_uid`)
		VALUES
			(#{house_img_id},#{house_develop_id},#{img_id},#{img_name},#{img_type},#{deleted},#{sort},#{create_time},#{create_uid})
  	</insert>
  	<!-- 删除单个图片 -->
  	<delete id="deleteByHouseImgId" parameterType="java.lang.String">
  		UPDATE `house_develop_img` SET `deleted`=1 WHERE `house_img_id`=#{house_img_id}
  	</delete>
  	<!-- 符合条件的开发房源图片列表 -->
  	<select id="searchHouseDevelopImgList" parameterType="java.util.Map" resultMap="HouseDevelopImgBaseMap">
  		SELECT
			hdi.house_img_id,hdi.house_develop_id,hdi.img_id,hdi.img_name,hdi.img_type,hdi.deleted,hdi.create_time,hdi.create_uid,
			i.src,hdi.sort,su.user_name as create_user,sd.dep_name as create_dep
		FROM
			house_develop_img AS hdi
		INNER JOIN image i ON i.img_id=hdi.img_id
		LEFT JOIN sys_user su on hdi.create_uid = su.user_id
		LEFT JOIN sys_department sd on sd.dep_id = su.dep_id
		WHERE
			hdi.deleted=0 AND i.deleted=0
			<if test="null != house_develop_id">
				AND hdi.house_develop_id=#{house_develop_id}
			</if>
			<if test="null != img_name">
				AND hdi.img_name LIKE CONCAT('%',#{img_name},'%')
			</if>
		ORDER BY IF(ISNULL(hdi.sort),1,0),hdi.sort ASC;
  	</select>
  	<!-- 符合条件的开发房源图片列表记录总数-->
  	<select id="countSearchHouseDevelopImg" parameterType="java.util.Map" resultType="java.lang.Integer">
  		SELECT
			COUNT(hdi.house_img_id)
		FROM
			house_develop_img AS hdi
		WHERE
			hdi.deleted=0
			<if test="null != house_develop_id">
				AND hdi.house_develop_id=#{house_develop_id}
			</if>
			<if test="null != img_name">
				AND hdi.img_name LIKE CONCAT('%',#{img_name},'%')
			</if>
  	</select>
  	<!-- 查询当前开发房源下的所有图片 -->
  	<select id="selectListByHouseDevelopId" parameterType="java.lang.String" resultMap="HouseDevelopImgBaseMap">
  		SELECT
			hdi.house_img_id,hdi.house_develop_id,hdi.img_id,hdi.img_name,hdi.img_type,hdi.deleted,hdi.create_time,hdi.create_uid,
			i.src,hdi.sort
		FROM
			house_develop_img AS hdi
		INNER JOIN image i ON i.img_id=hdi.img_id
		WHERE
			hdi.deleted=0 AND i.deleted=0 AND hdi.house_develop_id=#{house_develop_id}
  	</select>
</mapper>