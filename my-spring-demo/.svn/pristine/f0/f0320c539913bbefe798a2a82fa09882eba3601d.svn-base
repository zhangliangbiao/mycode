<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.isz.erp.house.mapper.ImageMapper">
	
    <!-- 根据楼盘id查询图片 -->	
	<select id="selectImageByResiId"  parameterType="java.lang.String" resultType="com.isz.erp.facade.house.entity.Image">
	   SELECT a.img_id,a.src,a.update_time,a.update_uid,a.create_time,a.create_uid,a.deleted FROM image a WHERE a.img_id in(
       SELECT t.img_id FROM residential_img t WHERE t.residential_id = #{residential_id})
	</select>
	<!-- 插入一张图片 -->
	<insert id="insertImage" parameterType="com.isz.erp.facade.house.entity.Image">
		INSERT INTO `image` 
			(`img_id`,`src`, `deleted`, `create_time`, `create_uid`, `update_time`, `update_uid`)
		VALUES 
			(#{img_id},#{src}, #{deleted}, #{create_time}, #{create_uid}, #{update_time}, #{update_uid})
	</insert>
	<!-- 根据开发房源id查询图片 -->	
	<select id="selectListByHouseDevelopId"  parameterType="java.lang.String" resultType="com.isz.erp.facade.house.entity.Image">
	  	SELECT i.img_id,
			i.src,
			i.deleted,
			i.create_time,
			i.create_uid,
			i.update_time,
			i.update_uid FROM image i INNER JOIN house_develop_img hdi ON i.img_id=hdi.img_id AND hdi.deleted=0
		WHERE hdi.house_develop_id=#{house_develop_id}
	</select>
	<!-- 根据出租房源id查询图片 -->	
	<select id="selectListByHouseId"  parameterType="java.lang.String" resultType="com.isz.erp.facade.house.entity.Image">
	  	SELECT i.img_id,
			i.src,
			i.deleted,
			i.create_time,
			i.create_uid,
			i.update_time,
			i.update_uid FROM image i INNER JOIN house_img hi ON i.img_id=hi.img_id AND hi.deleted=0
		WHERE hi.house_id=#{house_id}
	</select>
	<!-- 根据图片ID返回图片地址信息 -->
	<select id="searchApiImage" parameterType="java.util.List" resultType="java.util.Map">
		<foreach collection="list" item="item" index="index" separator="UNION ALL" >
			SELECT i.img_id imgId,
				CONCAT('http://img.ishangzu.com/',i.src) imgSrc,
				i.deleted,
				i.create_time createTime,
				i.create_uid createUid,
				i.update_time updateTime,
				i.update_uid updateUid
			FROM image i
			WHERE i.deleted=0 AND i.img_id=#{item.imgId}
		</foreach>
	</select>
</mapper>