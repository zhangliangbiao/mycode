<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.isz.erp.house.mapper.SysDistrictMapper">
    <select id="selectTreeListByParams" parameterType="java.util.Map" resultType="com.isz.erp.facade.house.vo.DistrictBusinessCircleVo">
        select
            sd.`code` id,
            sd.`name` text,
            sd.`level`,
            sd.parent_code p_id,
            (select `name` from sys_district where `code`=sd.parent_code) p_text
        from sys_district sd
        <where>
          <trim prefixOverrides="and">
              <if test="null != level and '' != level">
                  and sd.`level`=#{level}
              </if>
              <if test="null != parent_code and '' != parent_code">
                  and sd.parent_code=#{parent_code}
              </if>
          </trim>
        </where>
    </select>

    <select id="searchSysDistrictList" parameterType="java.util.Map" resultType="java.util.Map">
        select
            sd.*,
            (select `name` from sys_district where `code`=sd.parent_code) city_name
        from sys_district sd
        <include refid="searchSysDistrictSQL"></include>
    </select>

    <select id="countSearchSysDistrict" parameterType="java.util.Map" resultType="java.lang.Integer">
        select count(1) from sys_district sd
        <include refid="searchSysDistrictSQL"></include>
    </select>

    <sql id="searchSysDistrictSQL">
        <where>
            <trim prefixOverrides="and">
                <if test="null != level and '' != level">
                    and sd.`level`=#{level}
                </if>
                <if test="null != parent_code and '' != parent_code">
                    and sd.parent_code=#{parent_code}
                </if>
                <if test="null != name_search and '' != name_search">
                    and sd.`name` like CONCAT('%','${name_search}','%' )
                </if>
                <if test="null != spell_search and '' != spell_search">
                    and sd.`spell` like CONCAT('%','${spell_search}','%' )
                </if>
                <if test="null != name and '' != name">
                    and sd.`name`=#{name}
                </if>
                <if test="null != spell and '' != spell">
                    and sd.`spell`=#{spell}
                </if>
            </trim>
        </where>
    </sql>

    <select id="selectByParams" parameterType="java.util.Map" resultType="com.isz.erp.facade.user.entity.SysDistrict">
        select sd.* from sys_district sd
        <include refid="searchSysDistrictSQL"></include>
        limit 1
    </select>

    <select id="countSysDepartmentByCityCode" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from sys_department where dep_district=#{city_code} limit 1
    </select>

    <select id="countSysDistrictByParentCode" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from sys_district where parent_code=#{parent_code} limit 1
    </select>

    <select id="countSysRoleByCityCode" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from sys_role where city_code=#{city_code} limit 1
    </select>

    <select id="countSysPositionByCityCode" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from sys_position where city_code=#{city_code} limit 1
    </select>

    <select id="countResidentialByCode" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from residential where deleted=0 and (city_code=#{code} or area_code=#{code}) limit 1
    </select>

    <select id="countCustomerByCode" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from customer where deleted=0 and (city_code=#{code} or rent_area_code=#{code}) limit 1
    </select>

    <select id="countBusinessCircleByCode" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from business_circle_district where (city_code=#{code} or area_code=#{code}) limit 1
    </select>

</mapper>