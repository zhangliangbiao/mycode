<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.isz.erp.house.mapper.ResidentialImportMapper">
	<!-- 
	<insert id="insertResidentialExcelProcess" parameterType="com.isz.erp.facade.house.entity.ResidentialExcelProcess">
		insert into residential_excel_process(process_id,action,fileurl,read_num,succ_num,err_num,create_uid,create_time,remark)
		values(#{process_id},#{action},#{fileurl},#{read_num},#{succ_num},#{err_num},#{create_uid},#{create_time},#{remark})
	</insert> -->
	<select id="selectResidentialExcelProcess" parameterType="java.util.Map"
						resultType="com.isz.erp.facade.house.entity.ResidentialExcelProcess">
		SELECT process_id,`action`,file_name,file_url,read_num,succ_num,err_num,create_uid,create_uname,create_time,remark
 		from residential_excel_process WHERE process_id IS NOT NULL
 		<if test="null != action and '' != action">
			AND `action`=#{action}
		</if>
 		order by create_time desc 
	</select>
	<select id="selectResidentialExcelProcessCount" parameterType="java.util.Map"
						resultType="int">
		SELECT count(process_id) from residential_excel_process WHERE process_id IS NOT NULL
		<if test="null != action and '' != action">
			AND `action`=#{action}
		</if>
	</select>
	<!-- 楼盘 -->
	<select id="selectResidential" parameterType="com.isz.erp.facade.house.entity.Residential" 
						resultType="com.isz.erp.facade.house.entity.Residential">
		SELECT residential_id,city_code,area_code,residential_name,byname,address,property_type,property_use,property_company,property_fee,
			build_date,totle_buildings,build_area,metro_stations,bus_stations,lng,lat,plot_ratio,green_rate,parking_amount,other_info,remark,deleted,
			create_time,create_uid,update_time,update_uid		
		 from residential 
		 where deleted=0 
		 	<if test="residential_id != null and residential_id != ''"> and residential_id=#{residential_id} </if>
		 	<if test="residential_name != null and residential_name != ''"> and (residential_name=#{residential_name} or byname=#{residential_name}) </if>
		 	<if test="city_code != null and city_code != ''"> and city_code=#{city_code} </if>
		 	<if test="area_code != null and area_code != ''"> and area_code=#{area_code} </if>
		 order by create_time desc
		 limit 1 
	</select>
	
	<!-- 栋 -->
	<select id="selectResidentialBuilding" parameterType="com.isz.erp.facade.house.entity.ResidentialBuilding" 
						resultType="com.isz.erp.facade.house.entity.ResidentialBuilding">
		SELECT building_id,residential_id,building_name,suffix,ground_floors,underground_floors,housing_type,have_elevator,deleted,
			house_role,create_time,create_uid,update_time,update_uid,ladder_count,house_count 
		 from residential_building 
		 where  deleted=0 
		 	<if test="residential_id != null and residential_id != ''"> and residential_id=#{residential_id} </if>
		 	<if test="building_name != null and building_name != ''"> and building_name=#{building_name} </if>
	</select>
	<!-- 单元 -->
	<select id="selectResidentialBuildingUnit" parameterType="com.isz.erp.facade.house.entity.ResidentialBuildingUnit" 
						resultType="com.isz.erp.facade.house.entity.ResidentialBuildingUnit">
		SELECT unit_id,building_id,unit_name,sort,create_time,create_uid,update_time,update_uid
		 from residential_building_unit 
		  <where> 
		  	<if test="building_id != null and building_id != ''"> and building_id=#{building_id}  </if>
		 	<if test="unit_name != null and unit_name != ''"> and unit_name=#{unit_name} </if>
		 </where>
	</select>
	
	<select id="selectResidentialBuildingFloor" parameterType="com.isz.erp.facade.house.entity.ResidentialBuildingFloor" 
						resultType="com.isz.erp.facade.house.entity.ResidentialBuildingFloor">
		SELECT floor_id,building_id,unit_id,floor_name,sort,create_time,create_uid,update_time,update_uid
		 from residential_building_floor 
		  <where> 
		  	<if test="building_id != null and building_id != ''"> and building_id=#{building_id}  </if>
		  	<if test="unit_id != null and unit_id != ''"> and unit_id=#{unit_id}  </if>
		 	<if test="floor_name != null and floor_name != ''"> and floor_name=#{floor_name} </if>
		 </where>
	</select>
	
	<select id="selectResidentialBuildingHouseNo" parameterType="com.isz.erp.facade.house.entity.ResidentialBuildingHouseNo" 
						resultType="com.isz.erp.facade.house.entity.ResidentialBuildingHouseNo">
		SELECT house_no_id,building_id,unit_id,floor_id,house_no,sort,create_time,create_uid,update_time,update_uid
		 from residential_building_house_no 
		  <where> 
		  	<if test="city_code != null and city_code != ''"> and city_code=#{city_code}  </if>
		  	<if test="area_code != null and area_code != ''"> and area_code=#{area_code}  </if>
		  	<if test="building_id != null and building_id != ''"> and building_id=#{building_id}  </if>
		  	<if test="unit_id != null and unit_id != ''"> and unit_id=#{unit_id}  </if>
		  	<if test="floor_id != null and floor_id != ''"> and floor_id=#{floor_id}  </if>
		 	<if test="house_no != null and house_no != ''"> and house_no=#{house_no} </if>
		 </where>
	</select>
	
	<!-- 批量保存楼栋 -->
	<insert id="insertResidentialBuildingBatch" parameterType="java.util.List">
	    INSERT INTO `residential_building` 
			(`building_id`, `residential_id`, `building_name`, `suffix`, `ground_floors`, `underground_floors`,
			 `housing_type`, `have_elevator`, `deleted`, `house_role`, `create_time`,
			  `create_uid`, `update_time`, `update_uid`, `ladder_count`, `house_count` )
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	   (#{item.building_id},#{item.residential_id},#{item.building_name},#{item.suffix},#{item.ground_floors},#{item.underground_floors},
     	   #{item.housing_type},#{item.have_elevator},#{item.deleted},#{item.house_role},#{item.create_time},
     	   #{item.create_uid},#{item.update_time},#{item.update_uid},#{item.ladder_count},#{item.house_count})  
   		</foreach> 
	</insert>
	<!-- 批量保存单元 -->
	<insert id="insertResidentialBuildingUnitBatch" parameterType="java.util.List">
	    INSERT INTO `residential_building_unit` 
			(`unit_id`,`city_code`, `area_code`,`building_id`, `unit_name`, `sort`, `create_time`, `create_uid`, 
			`update_time`, `update_uid`)
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	   (#{item.unit_id},#{item.city_code},#{item.area_code},#{item.building_id},#{item.unit_name},#{item.sort},now(),#{item.create_uid},now(),
     	  	#{item.update_uid})  
   		</foreach> 
	</insert>
	<!-- 批量保存楼层信息 -->
	<insert id="insertResidentialBuildingFloorBatch" parameterType="java.util.List">
	    INSERT INTO `residential_building_floor` 
			(`floor_id`,`city_code`, `area_code`, `building_id`,`unit_id`, `floor_name`, `sort`, `create_time`, `create_uid`, 
			`update_time`, `update_uid`)
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	   (#{item.floor_id},#{item.city_code},#{item.area_code},#{item.building_id},#{item.unit_id},#{item.floor_name},#{item.sort},now(),#{item.create_uid},now(),
     	  	#{item.update_uid})  
   		</foreach> 
	</insert>
	<!-- 批量保存房号信息 -->
	<insert id="insertResidentialBuildingHouseNoBatch" parameterType="java.util.List">
	    INSERT INTO `residential_building_house_no` 
			(`house_no_id`, `city_code`, `area_code`, `building_id`,`unit_id`, `floor_id`, `house_no`, `sort`, `create_time`, 
			`create_uid`, `update_time`,`update_uid`)
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	   (#{item.house_no_id},#{item.city_code},#{item.area_code},#{item.building_id},#{item.unit_id},#{item.floor_id},#{item.house_no},#{item.sort},#{item.create_time},
     	   #{item.create_uid},#{item.update_time},#{item.update_uid})
   		</foreach> 
	</insert>
	
	<select id="selectCityAreaBusinessCircle" parameterType="com.isz.erp.house.vo.BusinessCircleVo" 
						resultType="com.isz.erp.house.vo.BusinessCircleVo">
		select a.business_circle_id,a.business_circle_name,b.business_circle_district_id,b.city_code,b.area_code 
		from business_circle a,business_circle_district b
		where b.city_code=#{city_code} and b.area_code=#{area_code} and b.business_circle_id=a.business_circle_id 
		and a.is_active='Y'
	</select>
	
	<select id="selectDepartByCityCode" parameterType="String" 
						resultType="com.isz.erp.facade.user.entity.SysDepart">
		select dep_id,dep_name,parent_id,sort,is_active,create_time,create_uid,update_time,update_uid,business_type,dep_district
				from sys_department
		where dep_district=#{city_code} and is_active='Y'
	</select>
	
	<!-- 批量保存楼盘 -->
	<insert id="insertResidentialBatch" parameterType="java.util.List">
	    INSERT INTO residential 
			(residential_id,city_code,area_code,residential_name,byname,address,property_type,
				property_use,property_company,property_fee,build_date,totle_buildings,build_area,
				metro_stations,bus_stations,lng,lat,plot_ratio,green_rate,parking_amount,
				total_unit_count,total_house_count,other_info,remark,deleted,create_time,
				create_uid,update_time,update_uid
			)
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	   (#{item.residential_id},#{item.city_code},#{item.area_code},#{item.residential_name},#{item.byname},#{item.address},#{item.property_type},
     	   #{item.property_use},#{item.property_company},#{item.property_fee},#{item.build_date},#{item.totle_buildings},#{item.build_area},
     	   #{item.metro_stations},#{item.bus_stations},#{item.lng},#{item.lat},#{item.plot_ratio},#{item.green_rate},#{item.parking_amount},
     	   #{item.total_unit_count},#{item.total_house_count},#{item.other_info},#{item.remark},#{item.deleted},#{item.create_time},
     	   #{item.create_uid},#{item.update_time},#{item.update_uid})  
   		</foreach> 
	</insert>
	
	<!-- 批量保存楼盘 商圈关联关系 -->
	<insert id="insertResidentialBusinessCircleBatch" parameterType="java.util.List">
	    INSERT INTO residential_business_circle 
			(residential_business_circle_id,business_circle_id,residential_id,create_time,create_uid)
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	  (#{item.residential_business_circle_id},#{item.business_circle_id},#{item.residential_id},#{item.create_time},#{item.create_uid})
   		</foreach> 
	</insert>
	
	<!-- 批量保存楼盘 责任部门关联关系 -->
	<insert id="insertResidentialDepartmentBatch" parameterType="java.util.List">
	    INSERT INTO residential_department 
			(residential_dep_id,residential_id,did,create_time,create_uid)
		VALUES
        <foreach collection="list" item="item" index="index" separator="," >  
     	  (#{item.residential_dep_id},#{item.residential_id},#{item.did},#{item.create_time},#{item.create_uid})
   		</foreach> 
	</insert>
	
</mapper>